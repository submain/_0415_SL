<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>角色管理</title>
    <script src="../jquery/jquery.js"></script>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <style>
        .layui-table {
            width: 1226px;
            border: 1px red solid;
            margin: 0 auto;
            text-align: center;
        }

        .title {
            width: 1226px;
            height: 30px;
            margin: 0 auto;
            text-align: center;
            font-weight: bold;
            font-size: 20px;
        }

        .layui-input-block {
            width: 80px;
        }

        .middle {
            width: 1226px;
            margin: 0 auto;

        }

        #test1 {

        }

        .pageContent {
            margin: 0 auto;
            width: 1226px;
            text-align: center;
        }

        .middle span {
            width: 50px;
            height: 30px;
            background-color: #01AAED;
            display: inline-block;
            text-align: center;
            line-height: 30px;
        }

        .layui-form-item {
            display: inline-block;
        }

        #addframe {
            width: 600px;
            height: 400px;
            /*border: 1px red solid;*/
        }

        .layui-input-block{
            width: 350px;
        }

    </style>
</head>
<body>
<div class="title">
    <p>角色管理</p>
</div>
<div class="middle">
    <span id="add">新增</span>
    <span>修改</span>
    <span id="deleteRole">删除</span>

</div>

<table class="layui-table">
    <thead style="text-align: center;font-weight: bold;">
    <tr>
        <td style="background-color: #01AAED">选择</td>
        <td style="background-color: #01AAED">角色编号</td>
        <td style="background-color: #01AAED">角色名称</td>
        <td style="background-color: #01AAED">创建人</td>
        <td style="background-color: #01AAED">状态（启用/禁用）</td>
        <td style="background-color: #01AAED">最后修改时间</td>
    </tr>
    </thead>
    <tbody class="my_t_body" id="my_t_body">
    <tr>
        <td><a href="">东城区</a></td>
        <td>2016-11-29</td>
        <td>人生就像是一场修行</td>
        <td>贤心</td>
        <td>2016-11-29</td>
        <td>人生就像是一场修行</td>
    </tr>
    <tr>
        <td>许闲心</td>
        <td>2016-11-28</td>
        <td>于千万人之中遇见你</td>
        <td>许闲心</td>
        <td>2016-11-28</td>
        <td>于千万人之中遇见你</td>
    </tr>

    </tbody>
</table>
<div class="pageContent">
    <div id="test1"></div>
</div>
<div id="addframe" style="display: none">
    <form action="" class="layui-form" style="margin-top: 30px">
        <div class="layui-form-item">
            <label class="layui-form-label">角色编号：</label>
            <div class="layui-input-block">
                <input type="text" name="title" required  lay-verify="required" placeholder="请输入角色编号" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">角色名称：</label>
            <div class="layui-input-block">
                <input type="text" name="title" required  lay-verify="required" placeholder="请输入姓名" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">角色状态</label>
            <div class="layui-input-block">
                <input type="radio" name="status" value="启用" title="启用" checked>
                <input type="radio" name="status" value="禁用" title="禁用" >
            </div>
        </div>
        <div class="layui-form-item" style="margin-left: 200px">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo" style="margin-top: 30px;display: inline-block;margin-left: -10px">保存</button>
                <button type="reset" class="layui-btn layui-btn-primary" style="margin-top: 30px;display: inline-block;margin-left: -3px">重置</button>
            </div>
        </div>
    </form>
</div>


</body>
<script src="../layui/layui.all.js"></script>
<script>
    $.ajax({
        url:"getRoleList",
        datatype: "json",
        type: "get",
        success: function (json) {
            console.log(json)
            renderAjaxTable(json.data)
        },
        error:function () {

        }
    })
    //渲染数据
    function renderAjaxTable(data) {
        $("#my_t_body").html("")
        $.each(data, function (index, eachobj) {
            if (index % 2 == 0) {
                if (eachobj.isStart == 1) {
                    var html = `<tr>
        <td><input type="checkbox" class="deleteChose" roleId="${eachobj.id}"></td>
        <td>${eachobj.roleCode}</td>
        <td>${eachobj.roleName}</td>
        <td>${eachobj.createdBy}</td>
        <td><input type="checkbox" id="${eachobj.id}" checked class="status"></td>
        <td>${eachobj.createDate}</td>

    </tr>`
                    $("#my_t_body").append(html)
                    $(".status").click(function () {
                        var id = $(this).attr("id")
                        if ($(this).is(':checked')) {


                            var status = 1
                            alert(status)
                            console.log(status)
                            madifyUserStatus(status, id)

                        } else {

                            var status = 0
                            console.log(status)
                            madifyUserStatus(status, id)

                        }

                    })
                } else {
                    var html = `<tr>
         <td><input type="checkbox" class="deleteChose" roleId="${eachobj.id}"></td>
        <td>${eachobj.roleCode}</td>
        <td>${eachobj.roleName}</td>
        <td>${eachobj.createdBy}</td>
        <td><input type="checkbox" id="${eachobj.id}" class="status"></td>
         <td>${eachobj.createDate}</td>

    </tr>`
                    $("#my_t_body").append(html)
                    $(".status").click(function () {
                        var id = $(this).attr("id")
                        if ($(this).is(':checked')) {
                            var status = 1
                            madifyUserStatus(status, id)
                        } else {
                            var status = 0

                            madifyUserStatus(status, id)
                        }

                    })
                }

            } else {
                if (eachobj.isStart == 1) {
                    var html = `<tr>
       <td style="background-color: #9FDEAD"><input type="checkbox" class="deleteChose" roleId="${eachobj.id}"></td>
        <td style="background-color: #9FDEAD">${eachobj.roleCode}</td>
        <td style="background-color: #9FDEAD">${eachobj.roleName}</td>
        <td style="background-color: #9FDEAD">${eachobj.createdBy}</td>
        <td style="background-color: #9FDEAD"><input type="checkbox" id="${eachobj.id}" checked class="status"></td>
          <td style="background-color: #9FDEAD">${eachobj.createDate}</td>
    </tr>`
                    $("#my_t_body").append(html)
                    $(".status").click(function () {
                        var id = $(this).attr("id")
                        if ($(this).is(':checked')) {
                            var status = 1
                            madifyUserStatus(status, id)
                        } else {
                            var status = 0
                            madifyUserStatus(status, id)

                        }

                    })
                } else {
                    var html = `<tr>
       <td style="background-color: #9FDEAD"><input type="checkbox" class="deleteChose" roleId="${eachobj.id}"></td>
        <td style="background-color: #9FDEAD">${eachobj.roleCode}</td>
        <td style="background-color: #9FDEAD">${eachobj.roleName}</td>
        <td style="background-color: #9FDEAD">${eachobj.createdBy}</td>
        <td style="background-color: #9FDEAD"><input type="checkbox" id="${eachobj.id}" class="status"></td>
        <td style="background-color: #9FDEAD">${eachobj.createDate}</td>
    </tr>`
                    $("#my_t_body").append(html)
                    $(".status").click(function () {
                        var id = $(this).attr("id")
                        if ($(this).is(':checked')) {
                            var status = 1
                        } else {
                            var status = 0
                            madifyUserStatus(status, id)
                        }

                    })
                }
            }
        })

    }

    //修改角色状态
    function madifyUserStatus(status, id) {
        $.ajax({
            url: "madifyRoleStatus",
            data: {"status": status, "id": id},
            datatype: "json",
            type: "get",
            success: function (json) {
                 console.log(json)

            },
            error: function () {

            }
        })
    }

    //修改
    layui.use('layer', function () {
        var layer = layui.layer;
        $("#add").click(function () {
            layer.open({
                type: 1,
                area: ['500px', '500px'],
                content: $('#addframe'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                cancel: function(index, layero){
                    if(confirm('确定要关闭么')){ //只有当点击confirm框的确定时，该层才会关闭
                        layer.close(index)
                        $("#addframe").css("display","none")
                    }
                    return false;
                }
            })
        })

    });


    //删除操作
    $("#deleteRole").click(function () {
        //用来记录是否有选中数据
        var isChose = 0
        $(".deleteChose").each(function () {
            var roleId=$(this).attr("roleId")
            if ($(this).is(':checked')) {
                isChose=1
                if (confirm("确定要删除这条信息吗")){
                    $.ajax({
                        url: "DeleteRole",
                        data: {"id": roleId},
                        datatype: "json",
                        type: "get",
                        success: function (json) {
                            console.log(json)

                        },
                        error: function () {

                        }
                    })
                }
            }

        })
        if (isChose==0){
            alert("请选择至少一项")
        }else {
            window.location.href=window.location.href
        }

    })


</script>
</html>